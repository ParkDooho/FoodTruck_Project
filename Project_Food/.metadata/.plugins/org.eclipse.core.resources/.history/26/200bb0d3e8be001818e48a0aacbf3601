package Project_Sever;



import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;


/**
 * UserDAO Class : Shop테이블의 Query 생성 매소드를 포함하는 Class
 * @author Location_based_services Server
 *
 */

public class UserDAO {
	private Connection con;

	public UserDAO(Connection con) {
		super();
		this.con = con;
	}
	

	@SuppressWarnings("unchecked")
	public JSONObject userLog(String userID, String userPW){
		JSONObject jsonMain = new JSONObject();
		JSONArray JArray = new JSONArray();
		String sql = "select userID, userPW from User where userID=? and userPW=?";
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);
			pstmt.setString(1,userID.replace("\r\n", "") );	
			pstmt.setString(2,userPW.replace("\r\n", "") );	
			ResultSet rs = pstmt.executeQuery();
			int count = 0;
			while(rs.next()) {
				UserDTO temp = new UserDTO();
				JSONObject jObject = new JSONObject();
				temp.setUserID(rs.getString("userID"));
				temp.setUserPW(rs.getString("userPW"));
				
				jObject.put("userID", temp.getUserID());
				jObject.put("userPW", temp.getUserPW());
				JArray.add(count,jObject);
				count++;
			}
			jsonMain.put("success", JArray);
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return jsonMain;
	}
	@SuppressWarnings("unchecked")
	public JSONObject shopLog(String shopID, String shopPW){
		JSONObject jsonMain = new JSONObject();
		JSONArray JArray = new JSONArray();
		String sql = "select shopID, shopPW from Shop where shopID=? and shopPW=?";
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);
			pstmt.setString(1,shopID.replace("\r\n", "") );	
			pstmt.setString(2,shopPW.replace("\r\n", "") );	
			ResultSet rs = pstmt.executeQuery();
			int count = 0;
			while(rs.next()) {
				ShopDTO temp = new ShopDTO();
				JSONObject jObject = new JSONObject();
				temp.setShopID(rs.getString("shopID"));
				temp.setShopPW(rs.getString("shopPW"));

				jObject.put("shopID", temp.getShopID());
				jObject.put("shopPW", temp.getShopPW());
				JArray.add(count,jObject);
				count++;
			}
			jsonMain.put("success", JArray);
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return jsonMain;
	}
	
	@SuppressWarnings("unchecked")
	public JSONObject userCheck(String userID){
		JSONObject jsonMain = new JSONObject();
		JSONArray JArray = new JSONArray();
		String sql = "select userID from User where userID=?";
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);
			pstmt.setString(1,userID.replace("\r\n", "") );	
			ResultSet rs = pstmt.executeQuery();
			int count = 0;
			while(rs.next()) {
				UserDTO temp = new UserDTO();
				JSONObject jObject = new JSONObject();
				temp.setUserID(rs.getString("userID"));
				
				jObject.put("userID", temp.getUserID());
				JArray.add(count,jObject);
				count++;
			}
			jsonMain.put("success", JArray);
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return jsonMain;
	}
	@SuppressWarnings("unchecked")
	public JSONObject shopCheck(String shopID){
		JSONObject jsonMain = new JSONObject();
		JSONArray JArray = new JSONArray();
		String sql = "select shopID, shopPW from Shop where shopID=?";
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);
			pstmt.setString(1,shopID.replace("\r\n", "") );	
			ResultSet rs = pstmt.executeQuery();
			int count = 0;
			while(rs.next()) {
				ShopDTO temp = new ShopDTO();
				JSONObject jObject = new JSONObject();
				temp.setShopID(rs.getString("shopID"));

				jObject.put("shopID", temp.getShopID());
				JArray.add(count,jObject);
				count++;
			}
			jsonMain.put("success", JArray);
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return jsonMain;
	}
	
	
	
	@SuppressWarnings("unchecked")
	public JSONObject selectData_text_Menu(String shopMenu){
		JSONObject jsonMain = new JSONObject();
		JSONArray JArray = new JSONArray();
		String sql = "Select shopID, shopName, shopMenu, shopPrice, shopEvent from Data_Text where shopMenu=?";
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);			
			pstmt.setString(1,shopMenu.replace("\r\n", "") );			
			ResultSet rs = pstmt.executeQuery();			
			int count =0;
			while(rs.next()) {
				Data_TextDTO temp = new Data_TextDTO();
				JSONObject jObject = new JSONObject();
				temp.setShopID(rs.getString("shopID"));
				temp.setShopName(rs.getString("shopName"));
				temp.setShopMenu(rs.getString("shopMenu"));
				temp.setShopPrice(rs.getInt("shopPrice"));
				temp.setShopEvent(rs.getString("shopEvent"));

				jObject.put("shopID", temp.getShopID());
				jObject.put("shopName", temp.getShopName());
				jObject.put("shopMenu", temp.getShopMenu());
				jObject.put("shopPrice", temp.getShopPrice());
				jObject.put("shopEvent", temp.getShopEvent());
				JArray.add(count,jObject);
				count++;
			}
			jsonMain.put("success", JArray);
		} catch (SQLException e) {
			e.printStackTrace();
		}
		
		return jsonMain;
	}
	

	@SuppressWarnings("unchecked")
	public JSONObject selectData_text_Name(String shopName){
		JSONObject jsonMain = new JSONObject();
		JSONArray JArray = new JSONArray();
		String sql = "Select shopID, shopName, shopMenu, shopPrice, shopEvent from Data_Text where shopName=?";
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);			
			pstmt.setString(1,shopName.replace("\r\n", "") );	
			ResultSet rs = pstmt.executeQuery();			
			int count =0;
			while(rs.next()) {
				Data_TextDTO temp = new Data_TextDTO();
				JSONObject jObject = new JSONObject();
				temp.setShopID(rs.getString("shopID"));
				temp.setShopName(rs.getString("shopName"));
				temp.setShopMenu(rs.getString("shopMenu"));
				temp.setShopPrice(rs.getInt("shopPrice"));
				temp.setShopEvent(rs.getString("shopEvent"));

				jObject.put("shopID", temp.getShopID());
				jObject.put("shopName", temp.getShopName());
				jObject.put("shopMenu", temp.getShopMenu());
				jObject.put("shopPrice", temp.getShopPrice());
				jObject.put("shopEvent", temp.getShopEvent());
				JArray.add(count,jObject);
				count++;
			}
			jsonMain.put("success", JArray);
		} catch (SQLException e) {
			e.printStackTrace();
		}
		
		return jsonMain;
	}
	
	/////////////////////////////////////////////////////////////

	

	public void  shopInsert(String shopID, String shopPW, String shopName, String shopTel, String shopOwner) {
		String sql = "insert into shop values(?,?,?,?,?)";		
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);
			pstmt.setString(1,shopID);
			pstmt.setString(2,shopPW);
			pstmt.setString(3,shopName);
			pstmt.setString(4,shopTel);
			pstmt.setString(5,shopOwner);
			pstmt.executeUpdate();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}
	
	public void  userInsert(String userID, String userPW, String userName, String userTel, String userNum) {
		String sql = "insert into user values(?,?,?,?,?)";		
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);
			pstmt.setString(1, userID);
			pstmt.setString(2, userPW);
			pstmt.setString(3, userName);
			pstmt.setString(4, userTel);
			pstmt.setString(5, userNum);
			pstmt.executeUpdate();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}
	
	public void  insertData_text(String shopID, String shopName, String shopMenu, int shopPrice, String shopEvent) {
		String sql = "insert into Data_Text values(?,?,?,?,?)";		
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);
			pstmt.setString(1,shopID);
			pstmt.setString(2,shopName);
			pstmt.setString(3,shopMenu);
			pstmt.setInt(4,shopPrice);
			pstmt.setString(5,shopEvent);
			pstmt.executeUpdate();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}
	
	//////////////////////////////////////////////////////////////
	
	public void  insertShop_GPS(String shopID, String shopAddr_x, Double shopAddr_y) {
		String sql = "insert into Data_Addr values(?,?,?)";		
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);
			pstmt.setString(1, shopID);
			pstmt.setString(2, shopAddr_x);
			//pstmt.setDouble(2, shopAddr_x);
			pstmt.setDouble(3,shopAddr_y);
			pstmt.executeUpdate();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}
	
	
	public void  deleteShop_GPS(String shopID, Double shopAddr_x, Double shopAddr_y) {
		String sql = "delete from Data_Addr where shopID=? and shopAddr_x=?, shopAddr_y=?";		
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);
			pstmt.setString(1, shopID);
			pstmt.setDouble(2, shopAddr_x);
			pstmt.setDouble(3,shopAddr_y);
			pstmt.executeUpdate();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	
	}
//////////////////////////////////////////////////////////////
	
	public void  insertShop_Image(String shopID, String shopPic) {
		String sql = "insert into Data_Picture values(?,?)";
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);
			pstmt.setString(1, shopID);
			pstmt.setString(2, shopPic);
			pstmt.executeUpdate();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	
	}
	
	
	@SuppressWarnings("unchecked")
	public JSONObject selectShop_ImageData(String shopID) {
		JSONObject jsonMain = new JSONObject();
		JSONArray JArray = new JSONArray();
	
		String sql = "Select shopPic from Data_Picture where shopID=?";
		try {
			PreparedStatement pstmt = con.prepareStatement(sql);			
			pstmt.setString(1,shopID.replace("\r\n", "") );			
			ResultSet rs = pstmt.executeQuery();			
			int count =0;
			while(rs.next()) {
				Data_PictureDTO temp = new Data_PictureDTO();
				JSONObject jObject = new JSONObject();
				temp.setShopPic(rs.getString("shopPic"));
			
				jObject.put("shopPic", temp.getShopPic());
				JArray.add(count,jObject);
				count++;
			}
			jsonMain.put("success", JArray);
		} catch (SQLException e) {
			e.printStackTrace();
		}
		
		return jsonMain;
	
	
	}
	

	
	
	
}
	
	
	
	
	




